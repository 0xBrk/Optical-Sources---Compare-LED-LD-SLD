<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optical Source Analyzer: LED vs LD vs SLD</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <!-- Placeholder Comments Required by Prompt -->
    <!-- Chosen Palette: Scientific Teal & Slate. Background: Slate-50 (Warm Neutral). Primary: Teal-600. Accents: Indigo-600, Rose-500. -->
    <!-- Application Structure Plan:
         1. Hero Section: Sets the context of the engineering task (Select source for optical link).
         2. Physics & Fundamentals: Interactive tabs explaining the three devices (LED, LD, SLD) with spectral visualizations to establish theory.
         3. Performance Matrix: A Radar Chart for qualitative comparison (Cost vs. Performance) to satisfy the "Compare devices" task.
         4. Link Budget Simulator (The Core): An interactive tool where users adjust link distance and connector losses. A Line Chart visualizes Power vs. Distance. This directly addresses the "Perform link budget" task interactively.
         5. Reliability & Conclusion: A generated report section that synthesizes the simulation data into a recommendation, satisfying the "Justify" and "Reliability" deliverables.
    -->
    <!-- Visualization & Content Choices:
         1. Spectral Output (Line Chart): Goal: Inform/Compare. Shows the difference in linewidth (LED broad vs LD narrow). Vital for understanding dispersion.
         2. Comparison Radar (Radar Chart): Goal: Compare. High-level view of Cost vs Bandwidth vs Power.
         3. Link Budget (Line Chart): Goal: Inform/Change. The 'meat' of the app. Shows signal decay over distance. Users interact with sliders to see when a source fails (drops below sensitivity).
         4. NO SVG/Mermaid: All visuals are Chart.js or CSS/HTML layout.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Slate 50 */
            color: #1e293b; /* Slate 800 */
        }
        h1, h2, h3 {
            font-family: 'Inter', sans-serif;
        }
        .mono {
            font-family: 'JetBrains Mono', monospace;
        }
        /* Chart Container Custom Classes for Responsiveness */
        .chart-wrapper {
            position: relative;
            width: 100%;
            height: 350px;
            max-height: 400px;
        }
        @media (max-width: 768px) {
            .chart-wrapper {
                height: 300px;
            }
        }
        /* Custom scrollbar for text areas */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Navigation / Header -->
    <header class="bg-white shadow-sm border-b border-slate-200 sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-teal-600 rounded flex items-center justify-center text-white font-bold">O</div>
                <h1 class="text-xl font-bold text-slate-800 tracking-tight">Optical<span class="text-teal-600">Source</span>Analyzer</h1>
            </div>
            <nav class="hidden md:flex gap-6 text-sm font-medium text-slate-600">
                <a href="#physics" class="hover:text-teal-600 transition">Physics</a>
                <a href="#comparison" class="hover:text-teal-600 transition">Comparison</a>
                <a href="#simulation" class="hover:text-teal-600 transition">Link Budget</a>
                <a href="#report" class="hover:text-teal-600 transition">Final Report</a>
            </nav>
            <button onclick="document.getElementById('simulation').scrollIntoView({behavior: 'smooth'})" class="bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded-md text-sm font-medium transition shadow-sm">
                Start Simulation
            </button>
        </div>
    </header>

    <main class="flex-grow">

        <!-- Hero Section -->
        <section class="bg-slate-50 py-12 border-b border-slate-200">
            <div class="container mx-auto px-4 text-center max-w-4xl">
                <div class="inline-block bg-teal-100 text-teal-800 text-xs px-3 py-1 rounded-full uppercase tracking-wider font-semibold mb-4">Engineering Design Task</div>
                <h2 class="text-4xl md:text-5xl font-extrabold text-slate-900 mb-6">Select the Optimal Optical Source</h2>
                <p class="text-lg text-slate-600 leading-relaxed mb-8">
                    Your mission: Design a reliable optical communication link. Compare <strong>LED</strong>, <strong>Laser Diode (LD)</strong>, and <strong>Superluminescent Diode (SLD)</strong>. Perform a link budget analysis to justify your selection for a high-speed fiber application.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-left mt-10">
                    <div class="bg-white p-5 rounded-lg shadow-sm border border-slate-200">
                        <div class="text-teal-600 text-2xl mb-2">‚ú¶</div>
                        <h3 class="font-bold text-slate-800">1. Analyze Physics</h3>
                        <p class="text-sm text-slate-500 mt-1">Understand Spontaneous vs. Stimulated emission mechanisms.</p>
                    </div>
                    <div class="bg-white p-5 rounded-lg shadow-sm border border-slate-200">
                        <div class="text-teal-600 text-2xl mb-2">‚öñÔ∏è</div>
                        <h3 class="font-bold text-slate-800">2. Compare Specs</h3>
                        <p class="text-sm text-slate-500 mt-1">Evaluate bandwidth, power, spectral width, and cost.</p>
                    </div>
                    <div class="bg-white p-5 rounded-lg shadow-sm border border-slate-200">
                        <div class="text-teal-600 text-2xl mb-2">üìâ</div>
                        <h3 class="font-bold text-slate-800">3. Simulate Link</h3>
                        <p class="text-sm text-slate-500 mt-1">Calculate power budget and select the winner.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 1: Physics & Emission Mechanisms -->
        <section id="physics" class="py-16 bg-white">
            <div class="container mx-auto px-4">
                <div class="mb-10 max-w-3xl mx-auto text-center">
                    <h2 class="text-3xl font-bold text-slate-900 mb-4">Emission Mechanisms</h2>
                    <p class="text-slate-600">
                        The fundamental difference between these sources lies in how they generate photons. This dictates their spectral width, coherence, and coupling efficiency.
                    </p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
                    <!-- Interactive Info Panel -->
                    <div class="space-y-4">
                        <!-- LED Card -->
                        <div class="group cursor-pointer border-l-4 border-rose-400 bg-slate-50 hover:bg-white p-6 rounded-r-lg transition-all duration-300 shadow-sm hover:shadow-md" onclick="updateSpectralChart('LED')">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-xl font-bold text-slate-800">LED (Light Emitting Diode)</h3>
                                <span class="bg-rose-100 text-rose-800 text-xs px-2 py-1 rounded font-mono">Spontaneous</span>
                            </div>
                            <p class="text-sm text-slate-600 mb-3">
                                Recombination of electron-hole pairs generates photons in random directions and phases. Broad spectral width (>40nm).
                            </p>
                            <div class="text-xs font-mono text-slate-500 bg-slate-200 inline-block px-2 py-1 rounded">
                                P_out: Low | Speed: Low
                            </div>
                        </div>

                        <!-- LD Card -->
                        <div class="group cursor-pointer border-l-4 border-teal-500 bg-slate-50 hover:bg-white p-6 rounded-r-lg transition-all duration-300 shadow-sm hover:shadow-md" onclick="updateSpectralChart('LD')">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-xl font-bold text-slate-800">LD (Laser Diode)</h3>
                                <span class="bg-teal-100 text-teal-800 text-xs px-2 py-1 rounded font-mono">Stimulated</span>
                            </div>
                            <p class="text-sm text-slate-600 mb-3">
                                Photons trigger further emission (cloning). Optical feedback (cavity) creates coherent, monochromatic, directional light. Narrow width (<1nm).
                            </p>
                            <div class="text-xs font-mono text-slate-500 bg-slate-200 inline-block px-2 py-1 rounded">
                                P_out: High | Speed: High
                            </div>
                        </div>

                        <!-- SLD Card -->
                        <div class="group cursor-pointer border-l-4 border-indigo-500 bg-slate-50 hover:bg-white p-6 rounded-r-lg transition-all duration-300 shadow-sm hover:shadow-md" onclick="updateSpectralChart('SLD')">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-xl font-bold text-slate-800">SLD (Superluminescent Diode)</h3>
                                <span class="bg-indigo-100 text-indigo-800 text-xs px-2 py-1 rounded font-mono">ASE</span>
                            </div>
                            <p class="text-sm text-slate-600 mb-3">
                                Amplified Spontaneous Emission. Like a laser without mirrors. High power and directionality (like LD) but low coherence (broad spectrum like LED).
                            </p>
                            <div class="text-xs font-mono text-slate-500 bg-slate-200 inline-block px-2 py-1 rounded">
                                P_out: Medium | Speed: Med
                            </div>
                        </div>
                    </div>

                    <!-- Chart Column -->
                    <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                        <h4 class="text-sm font-semibold text-slate-500 uppercase tracking-wider mb-4 text-center">Spectral Intensity Profile</h4>
                        <div class="chart-wrapper">
                            <canvas id="spectralChart"></canvas>
                        </div>
                        <p id="spectral-desc" class="text-xs text-center text-slate-400 mt-2 italic">
                            Select a device on the left to highlight its spectral characteristics.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 2: Comparison Matrix -->
        <section id="comparison" class="py-16 bg-slate-50 border-t border-slate-200">
            <div class="container mx-auto px-4">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

                    <!-- Radar Chart Container -->
                    <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-sm border border-slate-200 flex flex-col justify-center">
                        <h3 class="text-lg font-bold text-slate-800 mb-4 text-center">Performance Radar</h3>
                        <div class="chart-wrapper">
                            <canvas id="radarChart"></canvas>
                        </div>
                        <div class="mt-4 flex justify-center gap-4 text-xs">
                            <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-rose-400"></span> LED</div>
                            <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-teal-500"></span> LD</div>
                            <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-indigo-500"></span> SLD</div>
                        </div>
                    </div>

                    <!-- Comparison Table -->
                    <div class="lg:col-span-2 overflow-hidden rounded-xl border border-slate-200 shadow-sm bg-white">
                        <table class="w-full text-sm text-left text-slate-600">
                            <thead class="text-xs text-slate-700 uppercase bg-slate-100 border-b border-slate-200">
                                <tr>
                                    <th scope="col" class="px-6 py-4">Parameter</th>
                                    <th scope="col" class="px-6 py-4 text-rose-600">LED</th>
                                    <th scope="col" class="px-6 py-4 text-teal-600">Laser Diode (LD)</th>
                                    <th scope="col" class="px-6 py-4 text-indigo-600">SLD</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-100">
                                <tr class="hover:bg-slate-50 transition">
                                    <th class="px-6 py-4 font-medium text-slate-900">Output Power (into fiber)</th>
                                    <td class="px-6 py-4">Low (-15 to -10 dBm)</td>
                                    <td class="px-6 py-4 font-semibold">High (0 to +10 dBm)</td>
                                    <td class="px-6 py-4">Medium (-5 to +5 dBm)</td>
                                </tr>
                                <tr class="hover:bg-slate-50 transition">
                                    <th class="px-6 py-4 font-medium text-slate-900">Spectral Width (FWHM)</th>
                                    <td class="px-6 py-4">Broad (30-100 nm)</td>
                                    <td class="px-6 py-4 font-semibold">Narrow (< 1 nm)</td>
                                    <td class="px-6 py-4">Broad (20-50 nm)</td>
                                </tr>
                                <tr class="hover:bg-slate-50 transition">
                                    <th class="px-6 py-4 font-medium text-slate-900">Modulation Bandwidth</th>
                                    <td class="px-6 py-4">Low (< 200 MHz)</td>
                                    <td class="px-6 py-4 font-semibold">Very High (> 10 GHz)</td>
                                    <td class="px-6 py-4">Medium (~500 MHz)</td>
                                </tr>
                                <tr class="hover:bg-slate-50 transition">
                                    <th class="px-6 py-4 font-medium text-slate-900">Fiber Coupling</th>
                                    <td class="px-6 py-4">Poor (Lambertian)</td>
                                    <td class="px-6 py-4 font-semibold">Excellent (Directional)</td>
                                    <td class="px-6 py-4">Good (Directional)</td>
                                </tr>
                                <tr class="hover:bg-slate-50 transition">
                                    <th class="px-6 py-4 font-medium text-slate-900">Cost & Complexity</th>
                                    <td class="px-6 py-4 text-green-600">Low</td>
                                    <td class="px-6 py-4 text-rose-600">High (Temp control needed)</td>
                                    <td class="px-6 py-4 text-amber-600">Medium/High</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: Link Budget Simulator -->
        <section id="simulation" class="py-16 bg-white border-t border-slate-200 scroll-mt-20">
            <div class="container mx-auto px-4">
                <div class="mb-10 text-center max-w-2xl mx-auto">
                    <span class="text-teal-600 font-bold tracking-wider text-sm uppercase">Interactive Task</span>
                    <h2 class="text-3xl font-bold text-slate-900 mt-2">Link Budget Calculator</h2>
                    <p class="text-slate-600 mt-2">
                        Scenario: <strong>Single Mode Fiber (SMF) Link @ 1550nm</strong>. <br>
                        Receiver Sensitivity: <strong>-30 dBm</strong>. Adjust the sliders to test which source can maintain the link.
                    </p>
                </div>

                <div class="flex flex-col lg:flex-row gap-8">
                    <!-- Controls -->
                    <div class="lg:w-1/3 space-y-8 bg-slate-50 p-6 rounded-xl border border-slate-200 h-fit">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2 flex justify-between">
                                <span>Link Distance (km)</span>
                                <span id="val-dist" class="font-mono font-bold text-teal-700">50 km</span>
                            </label>
                            <input type="range" id="input-dist" min="1" max="150" value="50" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-teal-600">
                            <div class="flex justify-between text-xs text-slate-400 mt-1">
                                <span>1km (Campus)</span>
                                <span>150km (Long Haul)</span>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2 flex justify-between">
                                <span>Fiber Attenuation (dB/km)</span>
                                <span id="val-att" class="font-mono font-bold text-teal-700">0.25 dB/km</span>
                            </label>
                            <input type="range" id="input-att" min="0.15" max="0.5" step="0.05" value="0.25" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-teal-600">
                            <p class="text-xs text-slate-500 mt-1">0.2 dB/km is standard for SMF @ 1550nm.</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2 flex justify-between">
                                <span>Total Connector Loss (dB)</span>
                                <span id="val-conn" class="font-mono font-bold text-teal-700">2.0 dB</span>
                            </label>
                            <input type="range" id="input-conn" min="0" max="10" step="0.5" value="2.0" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-teal-600">
                        </div>

                        <div class="p-4 bg-teal-50 border border-teal-100 rounded-lg">
                            <h4 class="text-sm font-bold text-teal-800 mb-1">Formula:</h4>
                            <code class="text-xs text-teal-900 block font-mono">
                                P_rx = P_tx - (Attenuation √ó Distance) - Connectors - Margin
                            </code>
                            <p class="text-xs text-teal-700 mt-2">Safety Margin: <strong>3 dB</strong> (Fixed)</p>
                        </div>
                    </div>

                    <!-- Visualization -->
                    <div class="lg:w-2/3">
                        <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-lg">
                            <div class="chart-wrapper">
                                <canvas id="budgetChart"></canvas>
                            </div>
                        </div>

                        <!-- Dynamic Results Cards -->
                        <div class="grid grid-cols-3 gap-4 mt-6">
                            <!-- LED Result -->
                            <div id="res-led" class="p-4 rounded-lg border text-center transition-colors duration-300">
                                <div class="text-xs font-bold text-slate-500 uppercase">LED</div>
                                <div class="text-lg font-mono font-bold my-1 result-val">--</div>
                                <div class="text-xs font-semibold status-text">--</div>
                            </div>
                            <!-- LD Result -->
                            <div id="res-ld" class="p-4 rounded-lg border text-center transition-colors duration-300">
                                <div class="text-xs font-bold text-slate-500 uppercase">LD (Laser)</div>
                                <div class="text-lg font-mono font-bold my-1 result-val">--</div>
                                <div class="text-xs font-semibold status-text">--</div>
                            </div>
                            <!-- SLD Result -->
                            <div id="res-sld" class="p-4 rounded-lg border text-center transition-colors duration-300">
                                <div class="text-xs font-bold text-slate-500 uppercase">SLD</div>
                                <div class="text-lg font-mono font-bold my-1 result-val">--</div>
                                <div class="text-xs font-semibold status-text">--</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 4: Engineering Report & Justification -->
        <section id="report" class="py-16 bg-slate-50 border-t border-slate-200">
            <div class="container mx-auto px-4 max-w-4xl">
                <div class="flex items-center gap-3 mb-8">
                    <div class="h-px bg-slate-300 flex-grow"></div>
                    <h2 class="text-2xl font-bold text-slate-800 uppercase tracking-widest">Final Engineering Report</h2>
                    <div class="h-px bg-slate-300 flex-grow"></div>
                </div>

                <div class="bg-white p-8 rounded-lg shadow-sm border border-slate-200 prose prose-slate max-w-none">
                    <h3 class="text-xl font-bold text-teal-700 mb-4">1. Device Selection & Justification</h3>
                    <p class="mb-4">
                        Based on the comparative analysis and link budget simulation, the <strong>Laser Diode (LD)</strong> is selected as the optimal optical source for the proposed high-speed, long-distance link.
                    </p>
                    <ul class="list-disc pl-5 mb-6 space-y-2 text-slate-700">
                        <li><strong>Power Budget:</strong> As demonstrated in the simulation, the LD (0 dBm launch power) provides sufficient margin to overcome attenuation over distances >50km, whereas LED (-15 dBm) fails rapidly due to low coupling efficiency and power.</li>
                        <li><strong>Dispersion Limits:</strong> The LD's narrow spectral width (<1 nm) minimizes chromatic dispersion, which is critical for maintaining high data rates (>1 Gbps) over Single Mode Fiber. LED and SLD broad spectra would cause severe pulse broadening (Inter-Symbol Interference).</li>
                        <li><strong>SLD Role:</strong> While SLD offers higher power than LED, its broad spectrum makes it unsuitable for long-haul telecom. It is better reserved for short-range sensing (OCT) or navigation (FOG) where low coherence is an asset.</li>
                    </ul>

                    <h3 class="text-xl font-bold text-teal-700 mb-4">2. Reliability & Engineering Considerations</h3>
                    <p class="mb-4 text-slate-700">
                        While LD is the performance winner, the following engineering trade-offs must be managed:
                    </p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-slate-50 p-4 rounded border border-slate-200">
                            <h4 class="font-bold text-slate-900 mb-2">Thermal Management</h4>
                            <p class="text-sm text-slate-600">LD threshold current is highly temperature-dependent. A Thermo-Electric Cooler (TEC) and monitoring photodiode are required, increasing cost and power consumption compared to uncooled LEDs.</p>
                        </div>
                        <div class="bg-slate-50 p-4 rounded border border-slate-200">
                            <h4 class="font-bold text-slate-900 mb-2">Safety & Eye Care</h4>
                            <p class="text-sm text-slate-600">The high collimation and power density of LDs pose retinal hazard (Class 1/3B). Automatic Power Reduction (APR) mechanisms must be implemented if the fiber is cut.</p>
                        </div>
                    </div>
                </div>

                <div class="mt-12 text-center text-slate-400 text-sm">
                    <p>Report generated via Optical Source Analyzer SPA.</p>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-slate-900 text-slate-400 py-8">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2025 Optical Engineering Labs. Interactive Engineering Report.</p>
        </div>
    </footer>

    <!-- JavaScript Logic -->
    <script>
        // --- 1. Data & State ---
        const sources = {
            LED: {
                name: 'LED',
                powerTx: -15, // dBm
                color: 'rgba(251, 113, 133, 1)', // rose-400
                bg: 'rgba(251, 113, 133, 0.2)',
                spectralWidth: 40, // nm
                centerWavelength: 1310
            },
            LD: {
                name: 'Laser Diode',
                powerTx: 0, // dBm
                color: 'rgba(20, 184, 166, 1)', // teal-500
                bg: 'rgba(20, 184, 166, 0.2)',
                spectralWidth: 2, // nm (visual representation)
                centerWavelength: 1550
            },
            SLD: {
                name: 'SLD',
                powerTx: -5, // dBm
                color: 'rgba(99, 102, 241, 1)', // indigo-500
                bg: 'rgba(99, 102, 241, 0.2)',
                spectralWidth: 30, // nm
                centerWavelength: 1450 // Visual offset
            }
        };

        const sensitivity = -30; // dBm
        const safetyMargin = 3; // dB

        // --- 2. Chart Initialization ---

        // A. Spectral Chart
        const ctxSpectral = document.getElementById('spectralChart').getContext('2d');

        // Helper to generate Gaussian data
        function generateGaussian(center, width, height, points = 100) {
            const data = [];
            const labels = [];
            const start = 1200;
            const end = 1700;
            const step = (end - start) / points;

            for(let i = 0; i <= points; i++) {
                let x = start + (i * step);
                // Gaussian function: a * exp(-(x-b)^2 / (2c^2))
                let y = height * Math.exp(-Math.pow(x - center, 2) / (2 * Math.pow(width/2.355, 2)));
                labels.push(x.toFixed(0));
                data.push(y);
            }
            return { labels, data };
        }

        const spectralChart = new Chart(ctxSpectral, {
            type: 'line',
            data: {
                labels: generateGaussian(1550, 1, 1).labels, // Dummy labels init
                datasets: [
                    {
                        label: 'Intensity (a.u.)',
                        data: [],
                        borderColor: sources.LD.color,
                        backgroundColor: sources.LD.bg,
                        fill: true,
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: { mode: 'index', intersect: false }
                },
                scales: {
                    x: { title: { display: true, text: 'Wavelength (nm)' } },
                    y: { title: { display: true, text: 'Intensity' }, min: 0, max: 1.1 }
                },
                interaction: {
                    intersect: false,
                }
            }
        });

        // B. Radar Chart
        const ctxRadar = document.getElementById('radarChart').getContext('2d');
        const radarChart = new Chart(ctxRadar, {
            type: 'radar',
            data: {
                labels: ['Output Power', 'Modulation Speed', 'Coherence', 'Coupling Efficiency', 'Cost Efficiency'],
                datasets: [
                    {
                        label: 'LED',
                        data: [2, 1, 1, 1, 5], // Low power, Low speed, Low coherence, Poor coupling, High cost-efficiency (Cheap)
                        borderColor: sources.LED.color,
                        backgroundColor: sources.LED.bg,
                        borderWidth: 2
                    },
                    {
                        label: 'Laser Diode',
                        data: [5, 5, 5, 5, 2], // High power, High speed, High coherence, Great coupling, Low cost-efficiency (Expensive)
                        borderColor: sources.LD.color,
                        backgroundColor: sources.LD.bg,
                        borderWidth: 2
                    },
                    {
                        label: 'SLD',
                        data: [4, 3, 2, 4, 3], // Med power, Med speed, Low coherence, Good coupling, Med cost
                        borderColor: sources.SLD.color,
                        backgroundColor: sources.SLD.bg,
                        borderWidth: 2
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    r: {
                        min: 0,
                        max: 5,
                        ticks: { display: false }
                    }
                }
            }
        });

        // C. Link Budget Chart
        const ctxBudget = document.getElementById('budgetChart').getContext('2d');
        const budgetChart = new Chart(ctxBudget, {
            type: 'line',
            data: {
                labels: [], // Will be distance
                datasets: [
                    {
                        label: 'LED Signal',
                        data: [],
                        borderColor: sources.LED.color,
                        borderDash: [5, 5],
                        borderWidth: 2
                    },
                    {
                        label: 'LD Signal',
                        data: [],
                        borderColor: sources.LD.color,
                        borderWidth: 3
                    },
                    {
                        label: 'SLD Signal',
                        data: [],
                        borderColor: sources.SLD.color,
                        borderWidth: 2
                    },
                    {
                        label: 'Sensitivity Floor',
                        data: [],
                        borderColor: '#94a3b8', // Slate 400
                        borderWidth: 1,
                        pointRadius: 0,
                        fill: false
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: { display: true, text: 'Signal Power vs. Distance' },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': ' + context.parsed.y.toFixed(2) + ' dBm';
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        title: { display: true, text: 'Distance (km)' },
                        type: 'linear',
                        min: 0
                    },
                    y: {
                        title: { display: true, text: 'Received Power (dBm)' },
                        min: -60,
                        max: 10
                    }
                }
            }
        });

        // --- 3. Interaction Functions ---

        function updateSpectralChart(type) {
            const src = sources[type];
            let gData;

            // Generate visual data based on physics
            if (type === 'LED') {
                gData = generateGaussian(1310, 80, 0.6); // Broad, lower peak
            } else if (type === 'LD') {
                gData = generateGaussian(1550, 5, 1.0); // Narrow, high peak
            } else {
                gData = generateGaussian(1450, 60, 0.8); // Broad, med peak
            }

            spectralChart.data.labels = gData.labels;
            spectralChart.data.datasets[0].data = gData.data;
            spectralChart.data.datasets[0].borderColor = src.color;
            spectralChart.data.datasets[0].backgroundColor = src.bg;
            spectralChart.data.datasets[0].label = `${src.name} Spectrum`;
            spectralChart.update();

            // Highlight desc
            const spectralDesc = document.getElementById('spectral-desc');
            if (spectralDesc) {
                spectralDesc.textContent =
                    `${src.name}: ${type === 'LD' ? 'Narrow linewidth (<1nm) enables high data rates via SMF.' : 'Broad linewidth limits speed due to Chromatic Dispersion.'}`;
            }
        }

        function calculateBudget() {
            // Get inputs
            const distance = parseFloat(document.getElementById('input-dist').value);
            const attenuation = parseFloat(document.getElementById('input-att').value);
            const connectors = parseFloat(document.getElementById('input-conn').value);

            // Update Labels
            document.getElementById('val-dist').textContent = distance + ' km';
            document.getElementById('val-att').textContent = attenuation + ' dB/km';
            document.getElementById('val-conn').textContent = connectors + ' dB';

            // Generate Chart Data (0 to Distance + 10km buffer)
            const plotMaxDist = 150;
            const steps = 20;
            const stepSize = plotMaxDist / steps;

            const ledData = [];
            const ldData = [];
            const sldData = [];
            const sensData = [];
            const xLabels = [];

            // Physics Calcs
            // P_rx = P_tx - (alpha * L) - connectors - margin

            for(let i=0; i<=steps; i++) {
                const d = i * stepSize;
                xLabels.push(d);

                // Calculate P_rx for each
                const loss = (attenuation * d) + connectors + safetyMargin;

                ledData.push({x: d, y: sources.LED.powerTx - loss});
                ldData.push({x: d, y: sources.LD.powerTx - loss});
                sldData.push({x: d, y: sources.SLD.powerTx - loss});
                sensData.push({x: d, y: sensitivity});
            }

            // Update Chart
            budgetChart.data.labels = xLabels;
            budgetChart.data.datasets[0].data = ledData;
            budgetChart.data.datasets[1].data = ldData;
            budgetChart.data.datasets[2].data = sldData;
            budgetChart.data.datasets[3].data = sensData;
            budgetChart.options.scales.x.max = plotMaxDist;

            // Simplified: Just update the chart.
            budgetChart.update();

            // Calculate current specific point results
            const currentLoss = (attenuation * distance) + connectors + safetyMargin;
            updateResultCard('res-led', sources.LED.powerTx - currentLoss, sources.LED.color);
            updateResultCard('res-ld', sources.LD.powerTx - currentLoss, sources.LD.color);
            updateResultCard('res-sld', sources.SLD.powerTx - currentLoss, sources.SLD.color);
        }

        function updateResultCard(id, power, baseColor) {
            const el = document.getElementById(id);
            if (!el) return; // Defensive check for parent element

            const valEl = el.querySelector('.result-val');
            const statusEl = el.querySelector('.status-text');

            if (valEl) {
                valEl.textContent = power.toFixed(2) + ' dBm';
            }

            if (power >= sensitivity) {
                // Pass
                el.style.borderColor = baseColor.replace('1)', '1)'); // Solid
                el.style.backgroundColor = 'white';
                if (valEl) valEl.style.color = '#0f172a';
                if (statusEl) {
                    statusEl.textContent = "LINK OK";
                    statusEl.className = "text-xs font-bold text-teal-600";
                }
            } else {
                // Fail
                el.style.borderColor = '#e2e8f0';
                el.style.backgroundColor = '#f1f5f9';
                if (valEl) valEl.style.color = '#94a3b8';
                if (statusEl) {
                    statusEl.textContent = "SIGNAL LOST";
                    statusEl.className = "text-xs font-bold text-rose-500";
                }
            }
        }

        // --- 4. Listeners ---
        document.getElementById('input-dist').addEventListener('input', calculateBudget);
        document.getElementById('input-att').addEventListener('input', calculateBudget);
        document.getElementById('input-conn').addEventListener('input', calculateBudget);

        // --- 5. Initial Run ---
        updateSpectralChart('LD'); // Default view
        calculateBudget(); // Initial calc

    </script>
</body>
</html>


#####